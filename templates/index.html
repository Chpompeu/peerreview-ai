<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <title>PeerReview AI ‚Äî MVP</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      body { 
        font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji"; 
        margin: 2rem; 
        line-height: 1.5; 
        background-color: #f8f9fa;
      }
      .container { 
        max-width: 950px; 
        margin: auto; 
        background: white; 
        padding: 2rem; 
        border-radius: 10px; 
        box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      }
      textarea { 
        width: 100%; 
        height: 220px; 
        padding: 0.75rem; 
        border: 2px solid #e9ecef;
        border-radius: 8px;
        font-size: 14px;
        resize: vertical;
      }
      textarea:focus {
        outline: none;
        border-color: #007bff;
      }
      button { 
        padding: 0.6rem 1rem; 
        cursor: pointer; 
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 6px;
        font-weight: 500;
      }
      button:hover {
        background-color: #0056b3;
      }
      .card { 
        border: 1px solid #ddd; 
        border-radius: 10px; 
        padding: 1rem; 
        margin-top: 1rem; 
        background: #f8f9fa;
      }
      .grid { 
        display: grid; 
        grid-template-columns: 1fr 1fr; 
        gap: 1rem; 
      }
      .mono { 
        font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; 
        background: #f1f3f4;
        padding: 1rem;
        border-radius: 6px;
        overflow-x: auto;
      }
      .muted { 
        color: #6c757d; 
        font-size: 0.9rem; 
      }
      .pill { 
        display: inline-block; 
        padding: 0.2rem 0.6rem; 
        border: 1px solid #ccc; 
        border-radius: 999px; 
        margin-right: 0.25rem; 
        font-size: 0.85rem;
        background: white;
      }
      .row { 
        display: flex; 
        gap: 0.5rem; 
        align-items: baseline; 
      }
      .score-item {
        background: white;
        padding: 1rem;
        border-radius: 6px;
        border-left: 4px solid #007bff;
        margin-bottom: 0.5rem;
      }
      .score-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üîç PeerReview AI ‚Äî MVP Heur√≠stico</h1>
      <p class="muted">Validador r√°pido com regras simples para 5 dimens√µes. Retorna notas de 1 a 10 e explica√ß√µes.</p>

      <div class="card">
        <h3>Entrada</h3>
        <textarea id="text" placeholder="Cole aqui o abstract ou se√ß√£o para an√°lise..."></textarea>
        <div class="row" style="margin-top: 0.5rem;">
          <button onclick="run()">Analisar</button>
          <span id="status" class="muted"></span>
        </div>
      </div>

      <div id="out" class="card" style="display:none;">
        <h3>Resultados</h3>
        <div id="scores"></div>
        <h4>Explicabilidade</h4>
        <div id="explain"></div>
        <h4>Sinais Detectados</h4>
        <pre id="signals" class="mono"></pre>
      </div>

      <div class="card">
        <h3>Dimens√µes Avaliadas</h3>
        <div>
          <span class="pill">Relev√¢ncia e Originalidade</span>
          <span class="pill">Rigor Metodol√≥gico</span>
          <span class="pill">Qualidade da Escrita</span>
          <span class="pill">Fundamenta√ß√£o Te√≥rica</span>
          <span class="pill">Resultados e Discuss√£o</span>
        </div>
      </div>

      <p class="muted">‚ö†Ô∏è Aviso: Heur√≠sticas simples. N√£o substitui revis√£o humana. Use como triagem r√°pida ou apoio √† rubrica.</p>
    </div>

    <script>
      async function run(){
        const status = document.getElementById("status");
        const out = document.getElementById("out");
        const text = document.getElementById("text").value;
        
        if (!text.trim()) {
          status.textContent = "Por favor, insira um texto para an√°lise.";
          return;
        }
        
        status.textContent = "Analisando...";
        
        try {
          const res = await fetch("/analyze", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
          });
          
          if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
          }
          
          const data = await res.json();
          
          // Scores with better formatting
          const scoresDiv = document.getElementById("scores");
          scoresDiv.innerHTML = "";
          Object.entries(data.scores).forEach(([k, v]) => {
            const div = document.createElement("div");
            div.className = "score-item";
            div.innerHTML = `
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span><strong>${k}</strong></span>
                <span class="score-value">${v}/10</span>
              </div>
            `;
            scoresDiv.appendChild(div);
          });
          
          // Explainability
          const expDiv = document.getElementById("explain");
          expDiv.innerHTML = "";
          Object.entries(data.explainability).forEach(([k, v]) => {
            const p = document.createElement("p");
            p.innerHTML = `<strong>${k}:</strong> ${v}`;
            expDiv.appendChild(p);
          });
          
          // Signals
          const sig = document.getElementById("signals");
          sig.textContent = JSON.stringify(data.signals, null, 2);
          
          out.style.display = "block";
          status.textContent = "‚úÖ An√°lise conclu√≠da";
          
        } catch(e) {
          status.textContent = "‚ùå Erro na an√°lise";
          console.error("Erro:", e);
        }
      }
      
      // Allow Enter to trigger analysis
      document.getElementById("text").addEventListener("keydown", function(e) {
        if (e.ctrlKey && e.key === "Enter") {
          run();
        }
      });
    </script>
  </body>
</html>
